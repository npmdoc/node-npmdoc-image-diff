<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/uber/image-diff">image-diff (v1.6.3)</a>
</h1>
<h4>Create image differential between two images</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.image-diff">module image-diff</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.image-diff">
            function <span class="apidocSignatureSpan"></span>image-diff
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.ImageDiff">
            function <span class="apidocSignatureSpan">image-diff.</span>ImageDiff
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.getFullResult">
            function <span class="apidocSignatureSpan">image-diff.</span>getFullResult
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.getRawResult">
            function <span class="apidocSignatureSpan">image-diff.</span>getRawResult
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">image-diff.</span>ImageDiff.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.image-diff.ImageDiff">module image-diff.ImageDiff</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.ImageDiff.ImageDiff">
            function <span class="apidocSignatureSpan">image-diff.</span>ImageDiff
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.ImageDiff.createDiff">
            function <span class="apidocSignatureSpan">image-diff.ImageDiff.</span>createDiff
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.ImageDiff.extractDifference">
            function <span class="apidocSignatureSpan">image-diff.ImageDiff.</span>extractDifference
            <span class="apidocSignatureSpan">(output)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.ImageDiff.getImageSize">
            function <span class="apidocSignatureSpan">image-diff.ImageDiff.</span>getImageSize
            <span class="apidocSignatureSpan">(filepath, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.image-diff.ImageDiff.prototype">module image-diff.ImageDiff.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.ImageDiff.prototype.diff">
            function <span class="apidocSignatureSpan">image-diff.ImageDiff.prototype.</span>diff
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.ImageDiff.prototype.fullDiff">
            function <span class="apidocSignatureSpan">image-diff.ImageDiff.prototype.</span>fullDiff
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.image-diff.ImageDiff.prototype.rawDiff">
            function <span class="apidocSignatureSpan">image-diff.ImageDiff.prototype.</span>rawDiff
            <span class="apidocSignatureSpan">(options, callback)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.image-diff" id="apidoc.module.image-diff">module image-diff</a></h1>


    <h2>
        <a href="#apidoc.element.image-diff.image-diff" id="apidoc.element.image-diff.image-diff">
        function <span class="apidocSignatureSpan"></span>image-diff
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function imageDiff(options, cb) {
  var differ = new ImageDiff();
  differ.diff(options, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.image-diff.ImageDiff" id="apidoc.element.image-diff.ImageDiff">
        function <span class="apidocSignatureSpan">image-diff.</span>ImageDiff
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ImageDiff() {
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.image-diff.getFullResult" id="apidoc.element.image-diff.getFullResult">
        function <span class="apidocSignatureSpan">image-diff.</span>getFullResult
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFullResult = function (options, cb) {
  var differ = new ImageDiff();
  differ.fullDiff(options, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    - For example, if an image is `+` and we diff with `-`, then the image will have `|` be red but also contain a faded `-`
    - By default, this options is `false` meaning a shadow will not be drawn
- cb `Function` - Error-first function to handle diff result
- `cb` should have the signature `function (err, imagesAreSame)`
- err `Error|null` - If there was an error in diffing, this will be it
- imagesAreSame `Boolean` - Indicates that images are same or not

### `imageDiff.<span class="apidocCodeKeywordSpan">getFullResult</span>(options, cb)`
Same as `imageDiff` but yields a fuller result

- options `Object` - See `imageDiff#options`
- cb `Function` - Error-first function to handle diff result
- `cb` should have the signature `function (err, result)`
- err `Error|null` - If there was an error in diffing, this will be it
- result `Object`
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.image-diff.getRawResult" id="apidoc.element.image-diff.getRawResult">
        function <span class="apidocSignatureSpan">image-diff.</span>getRawResult
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getRawResult = function (options, cb) {
  var differ = new ImageDiff();
  differ.rawDiff(options, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  expectedImage: 'white.png',
  diffImage: 'difference.png',
}, function (err, result) {
  // result = {total: 46340.2, difference: 0.707107}
});
```

### `imageDiff.<span class="apidocCodeKeywordSpan">getRawResult</span>(options, cb)`
Same as `imageDiff` but yields raw CLI result

- options `Object` - See `imageDiff#options`
- cb `Function` - Error-first function to handle diff result
- `cb` should have the signature `function (err, result)`
- err `Error|null` - If there was an error in diffing, this will be it
- result `String` - Result from ImageMagick's `compare` command
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.image-diff.ImageDiff" id="apidoc.module.image-diff.ImageDiff">module image-diff.ImageDiff</a></h1>


    <h2>
        <a href="#apidoc.element.image-diff.ImageDiff.ImageDiff" id="apidoc.element.image-diff.ImageDiff.ImageDiff">
        function <span class="apidocSignatureSpan">image-diff.</span>ImageDiff
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ImageDiff() {
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.image-diff.ImageDiff.createDiff" id="apidoc.element.image-diff.ImageDiff.createDiff">
        function <span class="apidocSignatureSpan">image-diff.ImageDiff.</span>createDiff
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createDiff = function (options, cb) {
  // http://www.imagemagick.org/script/compare.php
  var diffCmd = 'compare';
  var diffArgs = [
    '-verbose',
    // TODO: metric and highlight could become constructor options
    '-metric', 'RMSE',
    '-highlight-color', 'RED']
    // Shadow options if options.shadow is set
    .concat(options.shadow ? [] : ['-compose', 'Src'])
    // Paths to actual, expected, and diff images
    .concat([
    options.actualPath,
    options.expectedPath,
    // If there is no output image, then output to `stdout` (which is ignored)
    options.diffPath || '-'
  ]);
  // Ignore `stdin` and `stdout` (useful for ignoring when images are being sent to stdout)
  var spawnOptions = {stdio: ['ignore', 'ignore', 'pipe']};
  bufferedSpawn(diffCmd, diffArgs, spawnOptions, function processDiffOutput (err, stdout, stderr) {
    // If we failed with no info, callback
    if (err &amp;&amp; !stderr) {
      return cb(err);
    }

    // Callback with raw result
    return cb(null, stderr);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.image-diff.ImageDiff.extractDifference" id="apidoc.element.image-diff.ImageDiff.extractDifference">
        function <span class="apidocSignatureSpan">image-diff.ImageDiff.</span>extractDifference
        <span class="apidocSignatureSpan">(output)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">extractDifference = function (output) {
  // Attempt to find variant between 'all: 0 (0)', 'all: 40131.8 (0.612372)', or 'all: 0.460961 (7.03381e-06)'
  // DEV: According to http://www.imagemagick.org/discourse-server/viewtopic.php?f=1&amp;t=17284
  // DEV: These values are the total square root mean square (RMSE) pixel difference across all pixels and its percentage
  // TODO: This is not very multi-lengual =(
  var resultInfo = output.match(/all: (\d+(?:\.\d+)?(?:[Ee]-?\d+)?) \((\d+(?:\.\d+)?(?:[Ee]-?\d+)?)\)/);
  if (!resultInfo) {
    throw new Error('Expected output to contain \'all\' but received "' + output + '"');
  }
  return {
    total: parseFloat(resultInfo[1], 10),
    percentage: parseFloat(resultInfo[2], 10)
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.image-diff.ImageDiff.getImageSize" id="apidoc.element.image-diff.ImageDiff.getImageSize">
        function <span class="apidocSignatureSpan">image-diff.ImageDiff.</span>getImageSize
        <span class="apidocSignatureSpan">(filepath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getImageSize = function (filepath, cb) {
  // TODO: This could be done via pngjs but stick to imagemagick for now
  fs.stat(filepath, function (err, stats) {
    // If the file does not exist, callback with info
    if (err) {
      if (err.code === 'ENOENT') {
        return cb(null, null);
      } else {
        return cb(err);
      }
    }

    gm(filepath).size(function (err, value) {
      if (err) {
        return cb(err);
      }
      cb(null, value);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.image-diff.ImageDiff.prototype" id="apidoc.module.image-diff.ImageDiff.prototype">module image-diff.ImageDiff.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.image-diff.ImageDiff.prototype.diff" id="apidoc.element.image-diff.ImageDiff.prototype.diff">
        function <span class="apidocSignatureSpan">image-diff.ImageDiff.prototype.</span>diff
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">diff = function (options, cb) {
  // Create a full diff
  this.fullDiff(options, function handleFullDiff (err, difference) {
    // If there was an error, callback with it
    if (err) {
      return cb(err);
    }

    // Otherwise, validate the difference and callback
    cb(null, difference.total === 0);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.image-diff.ImageDiff.prototype.fullDiff" id="apidoc.element.image-diff.ImageDiff.prototype.fullDiff">
        function <span class="apidocSignatureSpan">image-diff.ImageDiff.prototype.</span>fullDiff
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">fullDiff = function (options, cb) {
  // Create a raw diff
  this.rawDiff(options, function handleRawDiff (err, rawResult) {
    // If there was an error, callback with it
    if (err) {
      return cb(err);
    }

    // Otherwise, parse the result and callback
    cb(null, ImageDiff.extractDifference(rawResult));
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.image-diff.ImageDiff.prototype.rawDiff" id="apidoc.element.image-diff.ImageDiff.prototype.rawDiff">
        function <span class="apidocSignatureSpan">image-diff.ImageDiff.prototype.</span>rawDiff
        <span class="apidocSignatureSpan">(options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">rawDiff = function (options, callback) {
  // TODO: Break this down more...
  var actualPath = options.actualImage;
  var expectedPath = options.expectedImage;
  var diffPath = options.diffImage;
  var shadow = options.shadow;

  // Assert our options are passed in
  if (!actualPath) {
    return process.nextTick(function () {
      callback(new Error('`options.actualPath` was not passed to `image-diff`'));
    });
  }
  if (!expectedPath) {
    return process.nextTick(function () {
      callback(new Error('`options.expectedPath` was not passed to `image-diff`'));
    });
  }

  var actualTmpPath;
  var expectedTmpPath;
  var rawResult;
  async.waterfall([
    function assertActualPathExists (cb) {
      fs.exists(actualPath, function handleActualExists (actualExists) {
        if (actualExists) {
          cb();
        } else {
          cb(new Error('`image-diff` expected "' + actualPath + '" to exist but it didn\'t'));
        }
      });
    },
    function collectImageSizes (cb) {
      // Collect the images sizes
      async.map([actualPath, expectedPath], ImageDiff.getImageSize, cb);
    },
    function resizeImages (sizes, cb) {
      // Find the maximum dimensions
      var actualSize = sizes[0];
      var expectedSize = sizes[1] || {doesNotExist: true, height: 0, width: 0};
      var maxHeight = Math.max(actualSize.height, expectedSize.height);
      var maxWidth = Math.max(actualSize.width, expectedSize.width);

      // Resize both images
      async.parallel([
        function resizeActualImage (cb) {
          // Get a temporary filepath
          tmp.tmpName({postfix: '.png'}, function (err, filepath) {
            // If there was an error, callback
            if (err) {
              return cb(err);
            }

            // Otherwise, resize the image
            actualTmpPath = filepath;
            transparentExtent(gm(actualPath), {
              width: maxWidth,
              height: maxHeight
            }).write(actualTmpPath, cb);
          });
        },
        function resizeExpectedImage (cb) {
          tmp.tmpName({postfix: '.png'}, function (err, filepath) {
            // If there was an error, callback
            if (err) {
              return cb(err);
            }

            // If there was no expected image, create a transparent image to compare against
            expectedTmpPath = filepath;
            if (expectedSize.doesNotExist) {
              gm(maxWidth, maxHeight, 'transparent').write(expectedTmpPath, cb);
            // Otherwise, resize the image
            } else {
              transparentExtent(gm(expectedPath), {
                width: maxWidth,
                height: maxHeight
              }).write(expectedTmpPath, cb);
            }
          });
        }
      ], cb);
    },
    function createDiffDirectory (/*..., cb*/) {
      var cb = [].slice.call(arguments, -1)[0];
      if (diffPath) {
        mkdirp(path.dirname(diffPath), function (err) {
          cb(err);
        });
      } else {
        process.nextTick(cb);
      }
    },
    function createDiff (cb) {
      ImageDiff.createDiff({
        actualPath: actualTmpPath,
        expectedPath: expectedTmpPath,
        diffPath: diffPath,
        shadow: shadow
      }, function saveResult (err, _rawResult) {
        rawResult = _rawResult;
        cb(err);
      });
    }
  ], function cleanup (err) {
    // Clean up the temporary files
    var cleanupPaths = [actualTmpPath, expectedTmpPath].filter(function (filepath) {
      return !!filepath;
    });
    async.forEach(cleanupPaths, function cleanupFile (filepath, cb) {
      fs.unlink(filepath, cb);
    }, function callOriginalCallback (_err) {
      // Callback with the raw result
      callback(err, rawResult);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>